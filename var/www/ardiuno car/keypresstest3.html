<!DOCTYPE html>
<html>
<head>
<title>RC Car Controller</title>
<style> <!-- css script here -->
h1 {
	background-color: #6495ed;
}
p {
	background-color: #e0ffff;
}
img {
	margin: 20px;
	border: 1px solid red;
	height: 150px;
}
#touchable {
	font-size: 32px;
}
#mainBodyContainer {
	max-width: 870px;
	margin: auto;
	width: 90%;

}

</style>
<script> <!-- call php script here -->
function sendKey(str) {
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open("GET", "keypresstest.php?q=" + str, true);
	xmlhttp.send();
	xmlhttp.onreadystatechange = function() {
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			document.getElementById("serialResponseArea").innerHTML += xmlhttp.responseText;
		}
	}
}

function clickDown(id) {
	if (id.id=="upArrow") {sendKey("f");}
	if (id.id=="leftArrow") {sendKey("l");}
	if (id.id=="downArrow") {sendKey("b");}
	if (id.id=="rightArrow") {sendKey("r");}
	id.style.border='10px solid red';
	id.style.margin= '11px';
}

function clickUp(id) {
	if (id.id=="upArrow") {sendKey("g");}
	if (id.id=="leftArrow") {sendKey("m");}
	if (id.id=="downArrow") {sendKey("c");}
	if (id.id=="rightArrow") {sendKey("s");}
	id.style.border='1px solid red';
	id.style.margin= '20px';
}

function testingSomething(umm) {
	touchTest3.innerHTML += umm;
}

</script>

</head>

<body>
<div id="mainBodyContainer">
<h1>RC Car Controller</h1>
<p>To drive and steer use keys W, A, S and D.</p>
<!--
<p id="keyPressValue">Keypress Result: Nothing yet...</p>
<p id="randomArea">Area for random number goes here...</p>
<p id="lightSwitch">Lightswitch on,off etc...</p>
<p id="keysHeldDisplay">keysHeld contains...</p>
<p id="testArea">Test Area...</p>
-->
<img id="blankArrow" src="media/blank.jpg"></img>
<img id="upArrow" src="media/up.jpg" onmousedown="clickDown(this)" onmouseup="clickUp(this)"></img>
<img id="blankArrow" src="media/blank.jpg"></img></br>
<img id="leftArrow" src="media/left.jpg" onmousedown="clickDown(this)" onmouseup="clickUp(this)"></img>
<img id="downArrow" src="media/down.jpg" onmousedown="clickDown(this)" onmouseup="clickUp(this)"></img>
<img id="rightArrow" src="media/right.jpg" onmousedown="clickDown(this)" onmouseup="clickUp(this)"></img></br>
<p id="serialResponseArea">txtHint area</p>

<script> 
var upArrow = document.getElementById("upArrow");
var leftArrow = document.getElementById("leftArrow");
var downArrow = document.getElementById("downArrow");
var rightArrow = document.getElementById("rightArrow");
var keysHeld = [];
var removeThis;

function arrayContainsCheck(arrayName, checkForThis) { // a funciton to check if an array contains something
	for (var i = 0; i < arrayName.length; i++) {
		if (arrayName[i] === checkForThis) {
			return true;
		}
	}
	return false;
}

function keyRelease(arrayName, removeThis) { // a function to remove items from arrays
	var i = arrayName.indexOf(removeThis);
	if(i != -1) {
		arrayName.splice(i, 1);
	}
}

document.addEventListener('keydown', function(event) { // things happen as keys are pressed
	// document.getElementById("keyPressValue").innerHTML = "Keypress Result is " + event.keyCode + " (keyCode)"; // keyCodes I'm looking for are w=87,a=65,s=83,d=68, up=38, left=37, down=40, right=39.
	// document.getElementById("keysHeldDisplay").innerHTML = "keysHeld contains " + keysHeld + "."; // display the keycodes of the the keys being held
	// document.getElementById("lightSwitch").style.backgroundColor = "red"; // a red and blue indicator for when keys are held and released.
		
	if (!arrayContainsCheck(keysHeld, event.keyCode)) { // check if the key is already being held, this is so keydown events don't continue to propagate whilst a key is held
		// document.getElementById("testArea").innerHTML = "we got through an if statement because array didnt contain the keycode... it has " + keysHeld + " and key code was " + event.keyCode; 
		// document.getElementById("randomArea").innerHTML = "Putting a random number here \- " + Math.floor((Math.random() * 100) + 1) + ".";
		
		if(event.keyCode == 38 || event.keyCode == 87) { // up/w keys, sends "f"
			upArrow.style.border = "10px solid red";
			sendKey("f");
			upArrow.style.margin = '11px';
		}
		if(event.keyCode == 37 || event.keyCode == 65) { // left/a keys, sends "b"
			leftArrow.style.border = "10px solid red";
			sendKey("l");
			leftArrow.style.margin = '11px';
		}
		if(event.keyCode == 40 || event.keyCode == 83) { // down/s keys, sends "l"
			downArrow.style.border = "10px solid red";
			sendKey("b");
			downArrow.style.margin = '11px';
		}
		if(event.keyCode == 39 || event.keyCode == 68) { // right/d keys, sends "r"
			rightArrow.style.border = "10px solid red";
			sendKey("r");
			rightArrow.style.margin = '11px';
		}
		keysHeld.push(event.keyCode);
		} else {
		// document.getElementById("testArea").innerHTML = "keysHeld DOES contain " + event.keyCode;
	}
});

document.addEventListener('keyup', function(event) {
	// document.getElementById("lightSwitch").style.backgroundColor = "blue";
	if(event.keyCode == 38 || event.keyCode == 87) { // up, sends "g"
		upArrow.style.border = "1px solid red";
		upArrow.style.margin = '20px';
		sendKey("g");
	}
	if(event.keyCode == 37 || event.keyCode == 65) { // left, sends "m"
		leftArrow.style.border = "1px solid red";
		leftArrow.style.margin = '20px';
		sendKey("m");
	}
	if(event.keyCode == 40 || event.keyCode == 83) { // up, sends "c"
		downArrow.style.border = "1px solid red";
		downArrow.style.margin = '20px';
		sendKey("c");
	}
	if(event.keyCode == 39 || event.keyCode == 68) { // up, sends "s"
		rightArrow.style.border = "1px solid red";
		rightArrow.style.margin = '20px';
		sendKey("s");
	}
	keyRelease(keysHeld, event.keyCode);
});
</script>
<p>touch crap below this</p>
<div id='touchable'>TOUCHABLE EXAMPLE STUFF</div>
</br>
<div id='touchTest'>touchTest area. touchTest area.</div>
<div id='touchTest2'>22222</div>
<div id='touchTest3'>333333</div>
<div id='touchTest4'>4444444</div>
<div id='touchTest5'>55555</div>
<div id='touchTest6'>666666</div>

<script type="text/javascript">
var touchArea = document.getElementById('touchable');
var touchTest = document.getElementById('touchTest');
var touchTest2 = document.getElementById('touchTest2');
var touchTest3 = document.getElementById('touchTest3');
var touchTest4 = document.getElementById('touchTest4');
var touchTest5 = document.getElementById('touchTest5');
var touchTest6 = document.getElementById('touchTest6');

upArrow.addEventListener('touchstart', function(ev) {
	clickDown(this);
	/*if (ev.touches.item(0) == ev.targetTouches.item(0)) {
		touchTest.innerHTML = 'Hello Touch Events!';
	}
	if (ev.touches.length == ev.targetTouches.length) {
		touchTest.innerHTML = 'All points are on target element';
	}*/
}, false);

upArrow.addEventListener('touchend', function(ev) {
	clickUp(this);
}, false);

downArrow.addEventListener('touchstart', function(ev) {
	clickDown(this);
}, false);

downArrow.addEventListener('touchend', function(ev) {
	clickUp(this);
}, false);

leftArrow.addEventListener('touchstart', function(ev) {
	clickDown(this);
}, false);

leftArrow.addEventListener('touchend', function(ev) {
	clickUp(this);
}, false);

rightArrow.addEventListener('touchstart', function(ev) {
	clickDown(this);
}, false);

rightArrow.addEventListener('touchend', function(ev) {
	clickUp(this);
}, false);


</script>
</div>
</body>
</html>