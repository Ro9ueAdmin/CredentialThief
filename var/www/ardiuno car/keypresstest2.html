<!DOCTYPE html>
<html>
<head>
<title>Keypress test</title>
<style> <!-- css script here -->
h1 {
    background-color: #6495ed;
}
p {
    background-color: #e0ffff;
}
div {
    background-color: #b0c4de;
}
img {
    border: 1px solid red;
}
</style>
<script> <!-- call php script here -->
function sendKey(str) {
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open("GET", "keypresstest.php?q=" + str, true);
	xmlhttp.send();
	xmlhttp.onreadystatechange = function() {
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			document.getElementById("txtHint").innerHTML = document.getElementById("txtHint").innerHTML + xmlhttp.responseText;
		}
	}
}
</script>
</head>
<body>
<h1>JavaScript Keypress Test</h1>
<p>Press a key and let's see what happens...</p>
<p id="keyPressValue">Keypress Result: Nothing yet...</p>
<p id="randomArea">Area for random number goes here...</p>
<p id="lightSwitch">Lightswitch on,off etc...</p>
<p id="keysHeldDisplay">keysHeld contains...</p>
<p id="testArea">Test Area...</p>

<div id="arrowsArea">
<img id="blankArrow" src="media/blank.jpg"></img>
<img id="upArrow" src="media/up.jpg"></img>
<img id="blankArrow" src="media/blank.jpg"></img>
</br>
<img id="leftArrow" src="media/left.jpg"></img>
<img id="downArrow" src="media/down.jpg"></img>
<img id="rightArrow" src="media/right.jpg"></img>
<hr>
<p id="txtHint">txtHint area</p>
</div>

<script> <!-- page js key listenerner script here -->

var keysHeld = [];
var removeThis;

function arrayContainsCheck(arrayName, checkForThis) { // this is a funciton to check if an array contains something
    for (var i = 0; i < arrayName.length; i++) {
        if (arrayName[i] === checkForThis) {
            return true;
        }
    }
    return false;
}

function keyRelease(arrayName, removeThis) { // this is a function to remove items from arrays
	var i = arrayName.indexOf(removeThis);
	if(i != -1) {
		arrayName.splice(i, 1);
	}
}

document.addEventListener('keydown', function(event) { // things happen as keys are pressed
	document.getElementById("keyPressValue").innerHTML = "Keypress Result is " + event.keyCode + " (keyCode)"; // keyCodes I'm looking for are w=87,a=65,s=83,d=68, up=38, left=37, down=40, right=39.
	document.getElementById("keysHeldDisplay").innerHTML = "keysHeld contains " + keysHeld + "."; // display the keycodes of the the keys being held
	document.getElementById("lightSwitch").style.backgroundColor = "red"; // a red and blue indicator for when keys are held and released.
	
	if (!arrayContainsCheck(keysHeld, event.keyCode)) { // check if the key is already being held, this is so keydown events don't continue to propagate whilst a key is held
		document.getElementById("testArea").innerHTML = "we got through an if statement because array didnt contain the keycode... it has " + keysHeld + " and key code was " + event.keyCode; 
		document.getElementById("randomArea").innerHTML = "Putting a random number here \- " + Math.floor((Math.random() * 100) + 1) + ".";
		
		if(event.keyCode == 38 || event.keyCode == 87) { // up/w keys, send output to php script upon "f"
			document.getElementById("upArrow").style.border = "5px solid red";
			sendKey("f");
		}
		if(event.keyCode == 37 || event.keyCode == 65) { // left/a keys, send output to php script upon "b"
			document.getElementById("leftArrow").style.border = "5px solid red";
			sendKey("l");
		}
		if(event.keyCode == 40 || event.keyCode == 83) { // down/s keys, send output to php script upon "l"
			document.getElementById("downArrow").style.border = "5px solid red";
			sendKey("b");
		}
		if(event.keyCode == 39 || event.keyCode == 68) { // right/d keys, send output to php script upon "r"
			document.getElementById("rightArrow").style.border = "5px solid red";
			sendKey("r");
		}
		keysHeld.push(event.keyCode);
	} else {
		document.getElementById("testArea").innerHTML = "keysHeld DOES contain " + event.keyCode;
	}
});


document.addEventListener('keyup', function(event) {
	document.getElementById("lightSwitch").style.backgroundColor = "blue";
	if(event.keyCode == 38 || event.keyCode == 87) { <!-- up, sends output to file/serial g' -->
		document.getElementById("upArrow").style.border = "1px solid red";
		sendKey("g");
    }
	if(event.keyCode == 37 || event.keyCode == 65) { <!-- left, sends output to file/serial m' -->
		document.getElementById("leftArrow").style.border = "1px solid red";
		sendKey("m");
    }
	if(event.keyCode == 40 || event.keyCode == 83) { <!-- up, sends output to file/serial c' -->
		document.getElementById("downArrow").style.border = "1px solid red";
		sendKey("c");
    }
	if(event.keyCode == 39 || event.keyCode == 68) { <!-- up, sends output to file/serial s' -->
		document.getElementById("rightArrow").style.border = "1px solid red";
		sendKey("s");
    }
	keyRelease(keysHeld, event.keyCode);
	// document.getElementById("keysHeldDisplay").innerHTML = "keysHeld contains... " + keysHeld + ".";
});
</script>
</body>
</html>

